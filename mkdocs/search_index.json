{
    "docs": [
        {
            "location": "/", 
            "text": "Modeling 2018\n\n\nHow to collaborate\n\n\nUsing Git\n\n\nThis notes are saved into a Git repository. If you know how to use Git, feel free to use it:\n\n\ngit clone git@github.com:michogar/modeling.git\ncd modeling\n\n\n\nmake changes and`\n\n\ngit commit -a\ngit push\n\n\n\nWithout using Git\n\n\nA simple way to collaborate is downloading notes from \nhere\n.\nThen you can modify whatever you want and after that, send the \napuntes.md\n file\nto \nmichogar at gmail dot com\n with the subject [MODELING] in the mail.\n\n\nMarkdown\n\n\nNotes are writting in Markdown. There is a lot of tutorials on the web about this.\n\n\nTo learn a bit about Markdown you can:\n\n\n\n\nDo a online tutorial about it \nwww.markdowntutorial.com\n\n\nRead a bit about it \nMarkdown-Cheatsheet", 
            "title": "Index"
        }, 
        {
            "location": "/#modeling-2018", 
            "text": "", 
            "title": "Modeling 2018"
        }, 
        {
            "location": "/#how-to-collaborate", 
            "text": "", 
            "title": "How to collaborate"
        }, 
        {
            "location": "/#using-git", 
            "text": "This notes are saved into a Git repository. If you know how to use Git, feel free to use it:  git clone git@github.com:michogar/modeling.git\ncd modeling  make changes and`  git commit -a\ngit push", 
            "title": "Using Git"
        }, 
        {
            "location": "/#without-using-git", 
            "text": "A simple way to collaborate is downloading notes from  here .\nThen you can modify whatever you want and after that, send the  apuntes.md  file\nto  michogar at gmail dot com  with the subject [MODELING] in the mail.", 
            "title": "Without using Git"
        }, 
        {
            "location": "/#markdown", 
            "text": "Notes are writting in Markdown. There is a lot of tutorials on the web about this.  To learn a bit about Markdown you can:   Do a online tutorial about it  www.markdowntutorial.com  Read a bit about it  Markdown-Cheatsheet", 
            "title": "Markdown"
        }, 
        {
            "location": "/apuntes/", 
            "text": "ROMS_AGRIF Installation Ubuntu 17.04\n\n\nInstallation of Roms_tools\n\n\nDownload ROMS_AGRIF\n\n\nROMS_AGRIF v3.1.1\n\n\nUncompress tar\n\n\ntar -zxvf Roms_Agrif_v3.1.1_07_07_2014.tar.gz\n\n\n\nthis will create a folder named \nRoms_tools\n. Download ROMSTOOLS\n\n\nROMSTOOLS v3.1.1\n\n\nand uncompress these tools into the \nRoms_tools\n folder:\n\n\ntar -zxvf ROMSTOOLS_v3.1.1_07_07_2014.tar.gz\n\n\n\nDownload the toolboxes and softwares nedded by ROMSTOOLS\n\n\nUtilities\n\n\nand uncompress them:\n\n\ntar -zxvf Utilities_ROMSTOOLS_v3.0_21_12_2012.tar.gz\n\n\n\nCopy and renamed \nRun\n folder:\n\n\ncd Roms_tools\ncp Run Run_whatever\n\n\n\nInstall required \nnetcdf\n libraries:\n\n\nsudo apt install netcdf-bin libnetcdf-dev libnetcdff-dev\n\n\n\nCreation of required initial files\n\n\nYou will need download the needed datasets to create the required initial conditions.\nThese datasets ar in the CROCO Datasets website\n\nhttp://www.croco-ocean.org/download/datasets/\n\n\nGrid creation\n\n\nOpen Matlab and add \nRun_whatever\n folder:\n\n\n cd Run_whatever\n\n start\n\n\n\n\nexecute \nmake_grid\n to create netcdf with grid. To do this, we'll need the \netopo2.nc\n file.\n\n\nTopo\n\n\nOnce you get the \netopo2.nc\n put this in the path:\n\n\nRoms_tools/Topo/etopo2.nc\n\n\n\nand then:\n\n\n make_grid\n\n\n\n\n\n\nIf this error appears\nUndefined function or variable 'bitmax'.\nopen in Matlab the m_grid.m file and replace every bitmax by flintmax\n\n\n\n\nSurface boundary initial conditions\n\n\nTo make the forcing conditions, first we must get the needed netcdf files.\n\n\nCOADS05\n\n\nextract file into the \nRoms_tools\n and execute:\n\n\n make_forcing\n\n\n\n\nTemperature and Salinity initial conditions\n\n\nFirst, download the needed datasets. In this case get the CARS2009 dataset\n\n\nCARS2009\n\n\nor\n\n\nWOA2009\n\n\nextract into the \nRoms_tools\n and then execute:\n\n\n make_ini\n\n\n\n\n\n\nWe can execute the make_ini using CARS2009 or WOA2009. We can change the climate files\nmodifying the romstools_param.h:\n        %climato_dir=cars2009_dir;\n        climato_dir=woa_dir;  % Select this to use the WOAPISCES\n\n\n\n\nTemperature and salinity boundary and initial condition\n\n\nTo execute this, only:\n\n\n make_clim\n\n\n\n\nCompilation of model and running\n\n\nAfter the execution of the last 4 steps, we'll have 4 \nnetcdf\n files into the \nROMS_FILES\n folder:\n\n\n\n\nroms_clm.nc\n\n\nroms_frc.nc\n\n\nroms_grd.nc\n\n\nroms_ini.nc\n\n\n\n\nand other intermediate files not needed to get the model.\n\n\nCompilation in local (ONLY Linux)\n\n\nModify \njobcomp\n file into the \nRun_whatever\n folder to use \nlnetcdff\n, adding:\n\n\n...\n# If needed set your own NETCDF directories\n#\nNETCDFLIB=\"-L../../netcdf_x86_64 -lnetcdff\"\n...\n\n\n\nand execute:\n\n\n./jobcomp\n\n\n\nafter the compilation finish, then execute the model:\n\n\n./roms roms.in\n\n\n\nRunning with Intel compiler\n\n\nFirst, you'll need install the Intel Fortran Compiler into the machine.\n\n\nGet the Intel software in Student version from \nIntel Web\n\n\nChange the Linux compiler to the Intel compiler\n\n\nLINUX_FC = ifc\n\n\n\nthen in the \njobcomp\n file we must change flag options where \n$LINUX_FC=ifort || $LINUX_FC=ifc\n\n\nFFLAGS1=\"-03 -xAVX -72 -fno-alias -i4 -r8\"\n\n\n\nTo use the multiproccessing calculation we must change in the \ncppdefs.h\n\n\ndefine OPENMP\n\n\n\nCompilation in \"Carlos Cloud\"\n\n\nConnecting from Windows\n\n\nWe'll needed:\n\n\n\n\nPutty\n\n\nWinSCP\n\n\n\n\nWith WinSCP we can copy the \nnc\n files from our \nRun_whatever/ROMS_FILES\n folder to our \nrfirst/ROMS_FILES\n\nor whatever in the computer of Carlos (\nCC\n). Then we must copy our configuration files too:\n\n \nparams.h\n\n\n \ncppdefs.h\n\nin the \nrfirst\n folder\n\n\nThen we must use Putty to connect us\nto the CC and launch the compilation of the model. To do this:\n\n\njobcomp\n\n\n\nand after this finish\n\n\nroms roms.in\n\n\n\nIf we want launch the model and get out from the console, we can execute:\n\n\nnohup roms roms.in \n roms.out \n 2\n1 \n\n\n\n\nthis launch a process and return us a PID, or the number of the process. We can show\nthe process running with:\n\n\nps\n\n\n\nOnce the model is created, then you must download the \nnc\n files to your computer. To do this, you can use\nWinSCP.\n\n\n\n\nTo get CC credentials, contact with Carlos\n\n\n\n\nConfiguring the model\n\n\nAfter we execute \nmake_grid\n we'll obtain the \nLLm\n and \nMMm\n parameters that we must copy\nin the \nparams.h\n file.\n\n\n\n\ntheta_s: more layers close to the surface\n\n\ntheta_b: more layers close to the bottom\n\n\nhc: the minimmun depth of the model\n\n\n\n\nTo run \nzlevs\n:\n\n\ndepth=zlevs(100, 0, 5, 0, 10, 30, 'r', 2)\n\n\n\nr\n is the point in the Arakawa cell. It could be \nr\n, the center of the cell or \nw\n the top of the cell\n\nvtransform\n allow define the way the layer grow from coast to offshore. There are only two values \n1\n or \n2\n\n\nNesting grids\n\n\nTo nest a smallest grid into our model in Matlab,\n\n\n nestgui\n\n\n\n\n\nselect the parent grid, in our case \nroms_grd.nc\n into de \nROMS_FILES\n folder. Click in the\n\nDefine child\n button and select with the mouse the child grid area into the window opened.\n\n\nWith \nNew child topo\n we could select a new high resolution topography to the child.\n\nMatch volume\n allow match the volume between child and mom. Only in cases that mom knows\nthe child topo.\n\n\nr-factor\n indicates the depth relation between cells. Shoudn't be bigger than 20%.\n\nn-band\n in the boundary between mom and child the values must be identical. This value\nallow set how many cells are the boundary between them.\n\nHmin\n set the minimmun depth to simplify the model. Only in cases where the bathimetry has\ndepths under this minimmun depth.\n\n\nAfter we set the whole params, we have to get the\n\n\nrefine coeff\n set the refinement between mom and child grid. In the 99% cases this value\nwill be 3 for numeric stability. Is good that a mom cell is equal to a child cell.\n\n\nWe generate the \nroms.in\n from the gui and we can modify values into this file.\n\n\nClicking into the \nCreate AGRIF_FixedGrids.in\n generates the values from the UI to a file\ninto the root folder.\n\n\nOnce all these files are created we can run the model:\n\n\n\n\nOpen \ncppdefs.h\n and \ndefine\n the \nAGRIF\n and \nAGRIF_2WAY\n variables\n\n\nrun \njobcomp\n\n\nand then \nroms roms.in\n\n\n\n\nGenerating Rivers\n\n\nclobber\n removes the file if it exits.\n\n\nredef\n allow us define the attributes of the netcdf file. The order to define its if:\n\n Global attributes\n\n Dimensions\n* Variables and attributes\n\n\nGlobal attributes\n\n\n%% Global attributes:\nnc.title = ncchar('River file to use with ROMS');\nnc.title = 'River file to use with ROMS';\nnc.type = ncchar('ROMS river file');\nnc.type = 'ROMS river file';\n\n\n\nDimensions\n\n\n%% Dimensions:\n\nnc('qbar_time') = nd;\nnc('temp_src_time') = nd;\nnc('salt_src_time') = nd;\nnc('n_riv') = nr;\nnc('RivnameStrLen') = 14;\n\n\n\nVariables and attributes\n\n\n%% Variables and attributes:\n\nnc{'qbar_time'} = ncdouble('qbar_time'); %% 12 elements.\nnc{'qbar_time'}.long_name = ncchar('river runoff time');\nnc{'qbar_time'}.units = ncchar('days');\nnc{'qbar_time'}.cycle_length = ncdouble(36500);\n\nnc{'temp_src_time'} = ncdouble('temp_src_time'); %% 12 elements.\nnc{'temp_src_time'}.long_name = ncchar('river temperature time');\nnc{'temp_src_time'}.units = ncchar('days');\nnc{'temp_src_time'}.cycle_length = ncdouble(36500);\n\nnc{'salt_src_time'} = ncdouble('salt_src_time'); %% 12 elements.\nnc{'salt_src_time'}.long_name = ncchar('river salinity time');\nnc{'salt_src_time'}.units = ncchar('days');\nnc{'salt_src_time'}.cycle_length = ncdouble(36500);\n\nnc{'Qbar'} = ncdouble('n_riv', 'qbar_time'); %% 36 elements.\nnc{'Qbar'}.long_name = ncchar('river runoff time');\nnc{'Qbar'}.units = ncchar('m3/s');\n\nnc{'temp_src'} = ncdouble('n_riv', 'qbar_time'); %% 36 elements.\nnc{'temp_src'}.long_name = ncchar('river temperature time');\nnc{'temp_src'}.units = ncchar('\u00baC');\n\nnc{'salt_src'} = ncdouble('n_riv', 'qbar_time'); %% 36 elements.\nnc{'salt_src'}.long_name = ncchar('river salinity time');\nnc{'salt_src'}.units = ncchar('psu');\n\nnc{'riv_name'} = ncchar('n_riv', 'RivnameStrLen'); %% 6 elements.\nnc{'riv_name'}.long_name = ncchar('river runoff time');\n\n\n\nendef\n and \nclose\n to save these data into the file.\n\n\nThen we could generate the data to populate the file.\n\n\nTo add the river to the model, we need open the mask generated after the \nmake_grid\n execution.\nThen we must draw 3 cells in the exact point where we want add the river. Get the exact location\nin cell location units to put them in the \nroms.in\n file.\n\n\nIf river flows to west or south you must take the cell in land.\n\n\n\n\nfor rivers flowing to east or north you have to define the river in the water cell.\n\n\n\n\npsource_ncfile:   Nsrc  Isrc  Jsrc  Dsrc qbardir  Lsrc  Tsrc   runoff file name\n                                  ROMS_FILES/roms_rivers.nc\n                 1\n                        56  46  0  -1   30*T   5.0  0.0\n\n\n\nIn the \ncppdefs.h\n set \ndefine\n to the \nPSOURCE\n and \nPSOURCE_NCFILE\n variables.\n\n\nMake in zoom in\n\n\nWith the \naxis([minX maxX minY maxY minZ maxZ])\n we can manage the zoom into the model.\nIntroducing setting axis into the loop and adding time to the \nminX\n and \nminY\n we can\nshow a zoom to the point.\n\n\nChanging winds state\n\n\nSee the nc forcing file and the wind variables appears:\n\n\nnc{'sustr'}\nnc{'svstr'}\n\n\n\nand we can modify the value in we are interested, one month of north winds, one week or whatever.\nWe must know the relation between thc wind velocity and the streess caused by this wind on\nthe ocean surface. There is equations to solve this issue. Aprox 10m/s will be 0.1N/m2.\n\n\nOpen the file in write mode:\n\n\n  nc=netcdf('ROMS_FILES/roms_frc.nc', 'w');\n  nc{'sustr'}(:,:,:)=0\n  nc{'svstr'}(:,:,:)=-.1\n\n  close(nc)\n\n\n\nTides\n\n\nRun:\n\n\n  \n make_tides\n\n\n\nWe need define location and date into the 'romstools_param.m':\n\n\n%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n%\n% 5 - Parameters for tidal forcing\n%\n%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n%\n% TPXO file name (TPXO6 or TPXO7)\n%\ntidename=[DATADIR,'TPXO7/TPXO7.nc'];\n%\n% Number of tides component to process\n%\nNtides=10;\n%\n% Chose order from the rank in the TPXO file :\n% \"M2 S2 N2 K2 K1 O1 P1 Q1 Mf Mm\"\n% \" 1  2  3  4  5  6  7  8  9 10\"\n%\ntidalrank=[1 2 3 4 5 6 7 8 9 10];\n%\n% Compare with tidegauge observations\n%\nlon0 =  18.37;   % Example:\nlat0 = -33.91;   % Cape Town location\nZ0   =  1;       % Mean depth of tide gauge\n%\n\n\n\nand \ndefine TIDES\n variable in the \ncppdefs.h\n file.", 
            "title": "Notes"
        }, 
        {
            "location": "/apuntes/#roms_agrif-installation-ubuntu-1704", 
            "text": "", 
            "title": "ROMS_AGRIF Installation Ubuntu 17.04"
        }, 
        {
            "location": "/apuntes/#installation-of-roms_tools", 
            "text": "Download ROMS_AGRIF  ROMS_AGRIF v3.1.1  Uncompress tar  tar -zxvf Roms_Agrif_v3.1.1_07_07_2014.tar.gz  this will create a folder named  Roms_tools . Download ROMSTOOLS  ROMSTOOLS v3.1.1  and uncompress these tools into the  Roms_tools  folder:  tar -zxvf ROMSTOOLS_v3.1.1_07_07_2014.tar.gz  Download the toolboxes and softwares nedded by ROMSTOOLS  Utilities  and uncompress them:  tar -zxvf Utilities_ROMSTOOLS_v3.0_21_12_2012.tar.gz  Copy and renamed  Run  folder:  cd Roms_tools\ncp Run Run_whatever  Install required  netcdf  libraries:  sudo apt install netcdf-bin libnetcdf-dev libnetcdff-dev", 
            "title": "Installation of Roms_tools"
        }, 
        {
            "location": "/apuntes/#creation-of-required-initial-files", 
            "text": "You will need download the needed datasets to create the required initial conditions.\nThese datasets ar in the CROCO Datasets website http://www.croco-ocean.org/download/datasets/", 
            "title": "Creation of required initial files"
        }, 
        {
            "location": "/apuntes/#grid-creation", 
            "text": "Open Matlab and add  Run_whatever  folder:   cd Run_whatever  start  execute  make_grid  to create netcdf with grid. To do this, we'll need the  etopo2.nc  file.  Topo  Once you get the  etopo2.nc  put this in the path:  Roms_tools/Topo/etopo2.nc  and then:   make_grid   If this error appears\nUndefined function or variable 'bitmax'.\nopen in Matlab the m_grid.m file and replace every bitmax by flintmax", 
            "title": "Grid creation"
        }, 
        {
            "location": "/apuntes/#surface-boundary-initial-conditions", 
            "text": "To make the forcing conditions, first we must get the needed netcdf files.  COADS05  extract file into the  Roms_tools  and execute:   make_forcing", 
            "title": "Surface boundary initial conditions"
        }, 
        {
            "location": "/apuntes/#temperature-and-salinity-initial-conditions", 
            "text": "First, download the needed datasets. In this case get the CARS2009 dataset  CARS2009  or  WOA2009  extract into the  Roms_tools  and then execute:   make_ini   We can execute the make_ini using CARS2009 or WOA2009. We can change the climate files\nmodifying the romstools_param.h:\n        %climato_dir=cars2009_dir;\n        climato_dir=woa_dir;  % Select this to use the WOAPISCES", 
            "title": "Temperature and Salinity initial conditions"
        }, 
        {
            "location": "/apuntes/#temperature-and-salinity-boundary-and-initial-condition", 
            "text": "To execute this, only:   make_clim", 
            "title": "Temperature and salinity boundary and initial condition"
        }, 
        {
            "location": "/apuntes/#compilation-of-model-and-running", 
            "text": "After the execution of the last 4 steps, we'll have 4  netcdf  files into the  ROMS_FILES  folder:   roms_clm.nc  roms_frc.nc  roms_grd.nc  roms_ini.nc   and other intermediate files not needed to get the model.", 
            "title": "Compilation of model and running"
        }, 
        {
            "location": "/apuntes/#compilation-in-local-only-linux", 
            "text": "Modify  jobcomp  file into the  Run_whatever  folder to use  lnetcdff , adding:  ...\n# If needed set your own NETCDF directories\n#\nNETCDFLIB=\"-L../../netcdf_x86_64 -lnetcdff\"\n...  and execute:  ./jobcomp  after the compilation finish, then execute the model:  ./roms roms.in", 
            "title": "Compilation in local (ONLY Linux)"
        }, 
        {
            "location": "/apuntes/#running-with-intel-compiler", 
            "text": "First, you'll need install the Intel Fortran Compiler into the machine.  Get the Intel software in Student version from  Intel Web  Change the Linux compiler to the Intel compiler  LINUX_FC = ifc  then in the  jobcomp  file we must change flag options where  $LINUX_FC=ifort || $LINUX_FC=ifc  FFLAGS1=\"-03 -xAVX -72 -fno-alias -i4 -r8\"  To use the multiproccessing calculation we must change in the  cppdefs.h  define OPENMP", 
            "title": "Running with Intel compiler"
        }, 
        {
            "location": "/apuntes/#compilation-in-carlos-cloud", 
            "text": "", 
            "title": "Compilation in \"Carlos Cloud\""
        }, 
        {
            "location": "/apuntes/#connecting-from-windows", 
            "text": "We'll needed:   Putty  WinSCP   With WinSCP we can copy the  nc  files from our  Run_whatever/ROMS_FILES  folder to our  rfirst/ROMS_FILES \nor whatever in the computer of Carlos ( CC ). Then we must copy our configuration files too:   params.h    cppdefs.h \nin the  rfirst  folder  Then we must use Putty to connect us\nto the CC and launch the compilation of the model. To do this:  jobcomp  and after this finish  roms roms.in  If we want launch the model and get out from the console, we can execute:  nohup roms roms.in   roms.out   2 1    this launch a process and return us a PID, or the number of the process. We can show\nthe process running with:  ps  Once the model is created, then you must download the  nc  files to your computer. To do this, you can use\nWinSCP.   To get CC credentials, contact with Carlos", 
            "title": "Connecting from Windows"
        }, 
        {
            "location": "/apuntes/#configuring-the-model", 
            "text": "After we execute  make_grid  we'll obtain the  LLm  and  MMm  parameters that we must copy\nin the  params.h  file.   theta_s: more layers close to the surface  theta_b: more layers close to the bottom  hc: the minimmun depth of the model   To run  zlevs :  depth=zlevs(100, 0, 5, 0, 10, 30, 'r', 2)  r  is the point in the Arakawa cell. It could be  r , the center of the cell or  w  the top of the cell vtransform  allow define the way the layer grow from coast to offshore. There are only two values  1  or  2", 
            "title": "Configuring the model"
        }, 
        {
            "location": "/apuntes/#nesting-grids", 
            "text": "To nest a smallest grid into our model in Matlab,   nestgui   select the parent grid, in our case  roms_grd.nc  into de  ROMS_FILES  folder. Click in the Define child  button and select with the mouse the child grid area into the window opened.  With  New child topo  we could select a new high resolution topography to the child. Match volume  allow match the volume between child and mom. Only in cases that mom knows\nthe child topo.  r-factor  indicates the depth relation between cells. Shoudn't be bigger than 20%. n-band  in the boundary between mom and child the values must be identical. This value\nallow set how many cells are the boundary between them. Hmin  set the minimmun depth to simplify the model. Only in cases where the bathimetry has\ndepths under this minimmun depth.  After we set the whole params, we have to get the  refine coeff  set the refinement between mom and child grid. In the 99% cases this value\nwill be 3 for numeric stability. Is good that a mom cell is equal to a child cell.  We generate the  roms.in  from the gui and we can modify values into this file.  Clicking into the  Create AGRIF_FixedGrids.in  generates the values from the UI to a file\ninto the root folder.  Once all these files are created we can run the model:   Open  cppdefs.h  and  define  the  AGRIF  and  AGRIF_2WAY  variables  run  jobcomp  and then  roms roms.in", 
            "title": "Nesting grids"
        }, 
        {
            "location": "/apuntes/#generating-rivers", 
            "text": "clobber  removes the file if it exits.  redef  allow us define the attributes of the netcdf file. The order to define its if:  Global attributes  Dimensions\n* Variables and attributes", 
            "title": "Generating Rivers"
        }, 
        {
            "location": "/apuntes/#global-attributes", 
            "text": "%% Global attributes:\nnc.title = ncchar('River file to use with ROMS');\nnc.title = 'River file to use with ROMS';\nnc.type = ncchar('ROMS river file');\nnc.type = 'ROMS river file';", 
            "title": "Global attributes"
        }, 
        {
            "location": "/apuntes/#dimensions", 
            "text": "%% Dimensions:\n\nnc('qbar_time') = nd;\nnc('temp_src_time') = nd;\nnc('salt_src_time') = nd;\nnc('n_riv') = nr;\nnc('RivnameStrLen') = 14;", 
            "title": "Dimensions"
        }, 
        {
            "location": "/apuntes/#variables-and-attributes", 
            "text": "%% Variables and attributes:\n\nnc{'qbar_time'} = ncdouble('qbar_time'); %% 12 elements.\nnc{'qbar_time'}.long_name = ncchar('river runoff time');\nnc{'qbar_time'}.units = ncchar('days');\nnc{'qbar_time'}.cycle_length = ncdouble(36500);\n\nnc{'temp_src_time'} = ncdouble('temp_src_time'); %% 12 elements.\nnc{'temp_src_time'}.long_name = ncchar('river temperature time');\nnc{'temp_src_time'}.units = ncchar('days');\nnc{'temp_src_time'}.cycle_length = ncdouble(36500);\n\nnc{'salt_src_time'} = ncdouble('salt_src_time'); %% 12 elements.\nnc{'salt_src_time'}.long_name = ncchar('river salinity time');\nnc{'salt_src_time'}.units = ncchar('days');\nnc{'salt_src_time'}.cycle_length = ncdouble(36500);\n\nnc{'Qbar'} = ncdouble('n_riv', 'qbar_time'); %% 36 elements.\nnc{'Qbar'}.long_name = ncchar('river runoff time');\nnc{'Qbar'}.units = ncchar('m3/s');\n\nnc{'temp_src'} = ncdouble('n_riv', 'qbar_time'); %% 36 elements.\nnc{'temp_src'}.long_name = ncchar('river temperature time');\nnc{'temp_src'}.units = ncchar('\u00baC');\n\nnc{'salt_src'} = ncdouble('n_riv', 'qbar_time'); %% 36 elements.\nnc{'salt_src'}.long_name = ncchar('river salinity time');\nnc{'salt_src'}.units = ncchar('psu');\n\nnc{'riv_name'} = ncchar('n_riv', 'RivnameStrLen'); %% 6 elements.\nnc{'riv_name'}.long_name = ncchar('river runoff time');  endef  and  close  to save these data into the file.  Then we could generate the data to populate the file.  To add the river to the model, we need open the mask generated after the  make_grid  execution.\nThen we must draw 3 cells in the exact point where we want add the river. Get the exact location\nin cell location units to put them in the  roms.in  file.  If river flows to west or south you must take the cell in land.   for rivers flowing to east or north you have to define the river in the water cell.   psource_ncfile:   Nsrc  Isrc  Jsrc  Dsrc qbardir  Lsrc  Tsrc   runoff file name\n                                  ROMS_FILES/roms_rivers.nc\n                 1\n                        56  46  0  -1   30*T   5.0  0.0  In the  cppdefs.h  set  define  to the  PSOURCE  and  PSOURCE_NCFILE  variables.", 
            "title": "Variables and attributes"
        }, 
        {
            "location": "/apuntes/#make-in-zoom-in", 
            "text": "With the  axis([minX maxX minY maxY minZ maxZ])  we can manage the zoom into the model.\nIntroducing setting axis into the loop and adding time to the  minX  and  minY  we can\nshow a zoom to the point.", 
            "title": "Make in zoom in"
        }, 
        {
            "location": "/apuntes/#changing-winds-state", 
            "text": "See the nc forcing file and the wind variables appears:  nc{'sustr'}\nnc{'svstr'}  and we can modify the value in we are interested, one month of north winds, one week or whatever.\nWe must know the relation between thc wind velocity and the streess caused by this wind on\nthe ocean surface. There is equations to solve this issue. Aprox 10m/s will be 0.1N/m2.  Open the file in write mode:    nc=netcdf('ROMS_FILES/roms_frc.nc', 'w');\n  nc{'sustr'}(:,:,:)=0\n  nc{'svstr'}(:,:,:)=-.1\n\n  close(nc)", 
            "title": "Changing winds state"
        }, 
        {
            "location": "/apuntes/#tides", 
            "text": "Run:      make_tides  We need define location and date into the 'romstools_param.m':  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n%\n% 5 - Parameters for tidal forcing\n%\n%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n%\n% TPXO file name (TPXO6 or TPXO7)\n%\ntidename=[DATADIR,'TPXO7/TPXO7.nc'];\n%\n% Number of tides component to process\n%\nNtides=10;\n%\n% Chose order from the rank in the TPXO file :\n% \"M2 S2 N2 K2 K1 O1 P1 Q1 Mf Mm\"\n% \" 1  2  3  4  5  6  7  8  9 10\"\n%\ntidalrank=[1 2 3 4 5 6 7 8 9 10];\n%\n% Compare with tidegauge observations\n%\nlon0 =  18.37;   % Example:\nlat0 = -33.91;   % Cape Town location\nZ0   =  1;       % Mean depth of tide gauge\n%  and  define TIDES  variable in the  cppdefs.h  file.", 
            "title": "Tides"
        }
    ]
}