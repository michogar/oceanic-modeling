
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="shortcut icon" href="../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.6.4">
    
    
      
        <title>Notes - Modeling</title>
      
    
    
      <script src="../assets/javascripts/modernizr-1df76c4e58.js"></script>
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application-e2807e330f.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
  
  
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href=".." title="Modeling" class="md-icon md-icon--home md-header-nav__button">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
            
            Notes
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">close</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <div class="md-header-nav__source">
          
        </div>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-icon md-icon--home md-nav__button"></i>
    
    Modeling
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Index" class="md-nav__link">
      Index
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Notes
      </label>
    
    <a href="./" title="Notes" class="md-nav__link md-nav__link--active">
      Notes
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installation-of-roms_tools" title="Installation of Roms_tools" class="md-nav__link">
    Installation of Roms_tools
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creation-of-required-initial-files" title="Creation of required initial files" class="md-nav__link">
    Creation of required initial files
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#grid-creation" title="Grid creation" class="md-nav__link">
    Grid creation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#surface-boundary-initial-conditions" title="Surface boundary initial conditions" class="md-nav__link">
    Surface boundary initial conditions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#temperature-and-salinity-initial-conditions" title="Temperature and Salinity initial conditions" class="md-nav__link">
    Temperature and Salinity initial conditions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#temperature-and-salinity-boundary-and-initial-condition" title="Temperature and salinity boundary and initial condition" class="md-nav__link">
    Temperature and salinity boundary and initial condition
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compilation-of-model-and-running" title="Compilation of model and running" class="md-nav__link">
    Compilation of model and running
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#compilation-in-local-only-linux" title="Compilation in local (ONLY Linux)" class="md-nav__link">
    Compilation in local (ONLY Linux)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#running-with-intel-compiler" title="Running with Intel compiler" class="md-nav__link">
    Running with Intel compiler
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compilation-in-carlos-cloud" title="Compilation in "Carlos Cloud"" class="md-nav__link">
    Compilation in "Carlos Cloud"
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#connecting-from-windows" title="Connecting from Windows" class="md-nav__link">
    Connecting from Windows
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-the-model" title="Configuring the model" class="md-nav__link">
    Configuring the model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nesting-grids" title="Nesting grids" class="md-nav__link">
    Nesting grids
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generating-rivers" title="Generating Rivers" class="md-nav__link">
    Generating Rivers
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#global-attributes" title="Global attributes" class="md-nav__link">
    Global attributes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dimensions" title="Dimensions" class="md-nav__link">
    Dimensions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variables-and-attributes" title="Variables and attributes" class="md-nav__link">
    Variables and attributes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#make-in-zoom-in" title="Make in zoom in" class="md-nav__link">
    Make in zoom in
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#changing-winds-state" title="Changing winds state" class="md-nav__link">
    Changing winds state
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tides" title="Tides" class="md-nav__link">
    Tides
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installation-of-roms_tools" title="Installation of Roms_tools" class="md-nav__link">
    Installation of Roms_tools
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creation-of-required-initial-files" title="Creation of required initial files" class="md-nav__link">
    Creation of required initial files
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#grid-creation" title="Grid creation" class="md-nav__link">
    Grid creation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#surface-boundary-initial-conditions" title="Surface boundary initial conditions" class="md-nav__link">
    Surface boundary initial conditions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#temperature-and-salinity-initial-conditions" title="Temperature and Salinity initial conditions" class="md-nav__link">
    Temperature and Salinity initial conditions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#temperature-and-salinity-boundary-and-initial-condition" title="Temperature and salinity boundary and initial condition" class="md-nav__link">
    Temperature and salinity boundary and initial condition
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compilation-of-model-and-running" title="Compilation of model and running" class="md-nav__link">
    Compilation of model and running
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#compilation-in-local-only-linux" title="Compilation in local (ONLY Linux)" class="md-nav__link">
    Compilation in local (ONLY Linux)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#running-with-intel-compiler" title="Running with Intel compiler" class="md-nav__link">
    Running with Intel compiler
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compilation-in-carlos-cloud" title="Compilation in "Carlos Cloud"" class="md-nav__link">
    Compilation in "Carlos Cloud"
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#connecting-from-windows" title="Connecting from Windows" class="md-nav__link">
    Connecting from Windows
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-the-model" title="Configuring the model" class="md-nav__link">
    Configuring the model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nesting-grids" title="Nesting grids" class="md-nav__link">
    Nesting grids
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generating-rivers" title="Generating Rivers" class="md-nav__link">
    Generating Rivers
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#global-attributes" title="Global attributes" class="md-nav__link">
    Global attributes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dimensions" title="Dimensions" class="md-nav__link">
    Dimensions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variables-and-attributes" title="Variables and attributes" class="md-nav__link">
    Variables and attributes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#make-in-zoom-in" title="Make in zoom in" class="md-nav__link">
    Make in zoom in
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#changing-winds-state" title="Changing winds state" class="md-nav__link">
    Changing winds state
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tides" title="Tides" class="md-nav__link">
    Tides
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="roms_agrif-installation-ubuntu-1704">ROMS_AGRIF Installation Ubuntu 17.04</h1>
<h2 id="installation-of-roms_tools">Installation of Roms_tools</h2>
<p>Download ROMS_AGRIF</p>
<p><a href="ftp://ftp.legos.obs-mip.fr/pub/romsagrif/DATA_ROMS/CODE/Roms_Agrif_v3.1.1_07_07_2014.tar.gz">ROMS_AGRIF v3.1.1</a></p>
<p>Uncompress tar</p>
<pre><code>tar -zxvf Roms_Agrif_v3.1.1_07_07_2014.tar.gz
</code></pre>
<p>this will create a folder named <code>Roms_tools</code>. Download ROMSTOOLS</p>
<p><a href="ftp://ftp.legos.obs-mip.fr/pub/romsagrif/DATA_ROMS/TOOLS/ROMSTOOLS_v3.1.1_07_07_2014.tar.gz">ROMSTOOLS v3.1.1</a></p>
<p>and uncompress these tools into the <code>Roms_tools</code> folder:</p>
<pre><code>tar -zxvf ROMSTOOLS_v3.1.1_07_07_2014.tar.gz
</code></pre>
<p>Download the toolboxes and softwares nedded by ROMSTOOLS</p>
<p><a href="ftp://ftp.legos.obs-mip.fr/pub/romsagrif/DATA_ROMS/UTILITIES/Utilities_ROMSTOOLS_v3.0_21_12_2012.tar.gz">Utilities</a></p>
<p>and uncompress them:</p>
<pre><code>tar -zxvf Utilities_ROMSTOOLS_v3.0_21_12_2012.tar.gz
</code></pre>
<p>Copy and renamed <code>Run</code> folder:</p>
<pre><code>cd Roms_tools
cp Run Run_whatever
</code></pre>
<p>Install required <code>netcdf</code> libraries:</p>
<pre><code>sudo apt install netcdf-bin libnetcdf-dev libnetcdff-dev
</code></pre>
<h2 id="creation-of-required-initial-files">Creation of required initial files</h2>
<p>You will need download the needed datasets to create the required initial conditions.
These datasets ar in the CROCO Datasets website
<a href="http://www.croco-ocean.org/download/datasets/">http://www.croco-ocean.org/download/datasets/</a></p>
<h3 id="grid-creation">Grid creation</h3>
<p>Open Matlab and add <code>Run_whatever</code> folder:</p>
<pre><code>&gt;&gt; cd Run_whatever
&gt;&gt; start
</code></pre>

<p>execute <code>make_grid</code> to create netcdf with grid. To do this, we'll need the <code>etopo2.nc</code> file.</p>
<p><a href="ftp://ftp.legos.obs-mip.fr/pub/romsagrif/DATA_ROMS/Topo_26_05_2004.tar.gz">Topo</a></p>
<p>Once you get the <code>etopo2.nc</code> put this in the path:</p>
<pre><code>Roms_tools/Topo/etopo2.nc
</code></pre>
<p>and then:</p>
<pre><code>&gt;&gt; make_grid
</code></pre>

<blockquote>
<p>If this error appears
Undefined function or variable 'bitmax'.
open in Matlab the m_grid.m file and replace every bitmax by flintmax</p>
</blockquote>
<h3 id="surface-boundary-initial-conditions">Surface boundary initial conditions</h3>
<p>To make the forcing conditions, first we must get the needed netcdf files.</p>
<p><a href="ftp://ftp.legos.obs-mip.fr/pub/romsagrif/DATA_ROMS/COADS05_2006_10_25.tar.gz">COADS05</a></p>
<p>extract file into the <code>Roms_tools</code> and execute:</p>
<pre><code>&gt;&gt; make_forcing
</code></pre>

<h3 id="temperature-and-salinity-initial-conditions">Temperature and Salinity initial conditions</h3>
<p>First, download the needed datasets. In this case get the CARS2009 dataset</p>
<p><a href="ftp://ftp.legos.obs-mip.fr/pub/romsagrif/DATA_ROMS/CARS2009_02_10_2013.tar.gz">CARS2009</a></p>
<p>or</p>
<p><a href="ftp://ftp.legos.obs-mip.fr/pub/romsagrif/DATA_ROMS/WOA2009_24_06_2011.tar.gz">WOA2009</a></p>
<p>extract into the <code>Roms_tools</code> and then execute:</p>
<pre><code>&gt;&gt; make_ini
</code></pre>

<blockquote>
<p>We can execute the make_ini using CARS2009 or WOA2009. We can change the climate files
modifying the romstools_param.h:
        %climato_dir=cars2009_dir;
        climato_dir=woa_dir;  % Select this to use the WOAPISCES</p>
</blockquote>
<h3 id="temperature-and-salinity-boundary-and-initial-condition">Temperature and salinity boundary and initial condition</h3>
<p>To execute this, only:</p>
<pre><code>&gt;&gt; make_clim
</code></pre>

<h2 id="compilation-of-model-and-running">Compilation of model and running</h2>
<p>After the execution of the last 4 steps, we'll have 4 <code>netcdf</code> files into the <code>ROMS_FILES</code> folder:</p>
<ul>
<li>roms_clm.nc</li>
<li>roms_frc.nc</li>
<li>roms_grd.nc</li>
<li>roms_ini.nc</li>
</ul>
<p>and other intermediate files not needed to get the model.</p>
<h3 id="compilation-in-local-only-linux">Compilation in local (ONLY Linux)</h3>
<p>Modify <code>jobcomp</code> file into the <code>Run_whatever</code> folder to use <code>lnetcdff</code>, adding:</p>
<pre><code>...
# If needed set your own NETCDF directories
#
NETCDFLIB="-L../../netcdf_x86_64 -lnetcdff"
...
</code></pre>
<p>and execute:</p>
<pre><code>./jobcomp
</code></pre>
<p>after the compilation finish, then execute the model:</p>
<pre><code>./roms roms.in
</code></pre>
<h5 id="running-with-intel-compiler">Running with Intel compiler</h5>
<p>First, you'll need install the Intel Fortran Compiler into the machine.</p>
<p>Get the Intel software in Student version from <a href="https://software.intel.com/en-us/parallel-studio-xe/choose-download/student-linux-fortran">Intel Web</a></p>
<p>Change the Linux compiler to the Intel compiler</p>
<pre><code>LINUX_FC = ifc
</code></pre>
<p>then in the <code>jobcomp</code> file we must change flag options where <code>$LINUX_FC=ifort || $LINUX_FC=ifc</code></p>
<pre><code>FFLAGS1="-03 -xAVX -72 -fno-alias -i4 -r8"
</code></pre>
<p>To use the multiproccessing calculation we must change in the <code>cppdefs.h</code></p>
<pre><code>define OPENMP
</code></pre>
<h3 id="compilation-in-carlos-cloud">Compilation in "Carlos Cloud"</h3>
<h4 id="connecting-from-windows">Connecting from Windows</h4>
<p>We'll needed:</p>
<ul>
<li>Putty</li>
<li>WinSCP</li>
</ul>
<p>With WinSCP we can copy the <code>nc</code> files from our <code>Run_whatever/ROMS_FILES</code> folder to our <code>rfirst/ROMS_FILES</code>
or whatever in the computer of Carlos (<strong>CC</strong>). Then we must copy our configuration files too:
<em> <code>params.h</code>
</em> <code>cppdefs.h</code>
in the <code>rfirst</code> folder</p>
<p>Then we must use Putty to connect us
to the CC and launch the compilation of the model. To do this:</p>
<pre><code>jobcomp
</code></pre>
<p>and after this finish</p>
<pre><code>roms roms.in
</code></pre>
<p>If we want launch the model and get out from the console, we can execute:</p>
<pre><code>nohup roms roms.in &gt; roms.out &amp; 2&gt;&amp;1 &amp;
</code></pre>
<p>this launch a process and return us a PID, or the number of the process. We can show
the process running with:</p>
<pre><code>ps
</code></pre>
<p>Once the model is created, then you must download the <code>nc</code> files to your computer. To do this, you can use
WinSCP.</p>
<blockquote>
<p>To get CC credentials, contact with Carlos</p>
</blockquote>
<h3 id="configuring-the-model">Configuring the model</h3>
<p>After we execute <code>make_grid</code> we'll obtain the <code>LLm</code> and <code>MMm</code> parameters that we must copy
in the <code>params.h</code> file.</p>
<ul>
<li>theta_s: more layers close to the surface</li>
<li>theta_b: more layers close to the bottom</li>
<li>hc: the minimmun depth of the model</li>
</ul>
<p>To run <code>zlevs</code>:</p>
<pre><code>depth=zlevs(100, 0, 5, 0, 10, 30, 'r', 2)
</code></pre>
<p><code>r</code> is the point in the Arakawa cell. It could be <code>r</code>, the center of the cell or <code>w</code> the top of the cell
<code>vtransform</code> allow define the way the layer grow from coast to offshore. There are only two values <code>1</code> or <code>2</code></p>
<h2 id="nesting-grids">Nesting grids</h2>
<p>To nest a smallest grid into our model in Matlab,</p>
<pre><code>&gt;&gt; nestgui
</code></pre>
<p><img alt="" src="../images/child_area.png" /></p>
<p>select the parent grid, in our case <code>roms_grd.nc</code> into de <code>ROMS_FILES</code> folder. Click in the
<code>Define child</code> button and select with the mouse the child grid area into the window opened.</p>
<p>With <code>New child topo</code> we could select a new high resolution topography to the child.
<code>Match volume</code> allow match the volume between child and mom. Only in cases that mom knows
the child topo.</p>
<p><code>r-factor</code> indicates the depth relation between cells. Shoudn't be bigger than 20%.
<code>n-band</code> in the boundary between mom and child the values must be identical. This value
allow set how many cells are the boundary between them.
<code>Hmin</code> set the minimmun depth to simplify the model. Only in cases where the bathimetry has
depths under this minimmun depth.</p>
<p>After we set the whole params, we have to get the</p>
<p><code>refine coeff</code> set the refinement between mom and child grid. In the 99% cases this value
will be 3 for numeric stability. Is good that a mom cell is equal to a child cell.</p>
<p>We generate the <code>roms.in</code> from the gui and we can modify values into this file.</p>
<p>Clicking into the <code>Create AGRIF_FixedGrids.in</code> generates the values from the UI to a file
into the root folder.</p>
<p>Once all these files are created we can run the model:</p>
<ul>
<li>Open <code>cppdefs.h</code> and <code>define</code> the <code>AGRIF</code> and <code>AGRIF_2WAY</code> variables</li>
<li>run <code>jobcomp</code></li>
<li>and then <code>roms roms.in</code></li>
</ul>
<h2 id="generating-rivers">Generating Rivers</h2>
<p><code>clobber</code> removes the file if it exits.</p>
<p><code>redef</code> allow us define the attributes of the netcdf file. The order to define its if:
<em> Global attributes
</em> Dimensions
* Variables and attributes</p>
<h3 id="global-attributes">Global attributes</h3>
<pre><code>%% Global attributes:
nc.title = ncchar('River file to use with ROMS');
nc.title = 'River file to use with ROMS';
nc.type = ncchar('ROMS river file');
nc.type = 'ROMS river file';
</code></pre>
<h3 id="dimensions">Dimensions</h3>
<pre><code>%% Dimensions:

nc('qbar_time') = nd;
nc('temp_src_time') = nd;
nc('salt_src_time') = nd;
nc('n_riv') = nr;
nc('RivnameStrLen') = 14;
</code></pre>
<h3 id="variables-and-attributes">Variables and attributes</h3>
<pre><code>%% Variables and attributes:

nc{'qbar_time'} = ncdouble('qbar_time'); %% 12 elements.
nc{'qbar_time'}.long_name = ncchar('river runoff time');
nc{'qbar_time'}.units = ncchar('days');
nc{'qbar_time'}.cycle_length = ncdouble(36500);

nc{'temp_src_time'} = ncdouble('temp_src_time'); %% 12 elements.
nc{'temp_src_time'}.long_name = ncchar('river temperature time');
nc{'temp_src_time'}.units = ncchar('days');
nc{'temp_src_time'}.cycle_length = ncdouble(36500);

nc{'salt_src_time'} = ncdouble('salt_src_time'); %% 12 elements.
nc{'salt_src_time'}.long_name = ncchar('river salinity time');
nc{'salt_src_time'}.units = ncchar('days');
nc{'salt_src_time'}.cycle_length = ncdouble(36500);

nc{'Qbar'} = ncdouble('n_riv', 'qbar_time'); %% 36 elements.
nc{'Qbar'}.long_name = ncchar('river runoff time');
nc{'Qbar'}.units = ncchar('m3/s');

nc{'temp_src'} = ncdouble('n_riv', 'qbar_time'); %% 36 elements.
nc{'temp_src'}.long_name = ncchar('river temperature time');
nc{'temp_src'}.units = ncchar('ÂºC');

nc{'salt_src'} = ncdouble('n_riv', 'qbar_time'); %% 36 elements.
nc{'salt_src'}.long_name = ncchar('river salinity time');
nc{'salt_src'}.units = ncchar('psu');

nc{'riv_name'} = ncchar('n_riv', 'RivnameStrLen'); %% 6 elements.
nc{'riv_name'}.long_name = ncchar('river runoff time');
</code></pre>
<p><code>endef</code> and <code>close</code> to save these data into the file.</p>
<p>Then we could generate the data to populate the file.</p>
<p>To add the river to the model, we need open the mask generated after the <code>make_grid</code> execution.
Then we must draw 3 cells in the exact point where we want add the river. Get the exact location
in cell location units to put them in the <code>roms.in</code> file.</p>
<p>If river flows to west or south you must take the cell in land.</p>
<p><img alt="" src="../images/river_es.png" /></p>
<p>for rivers flowing to east or north you have to define the river in the water cell.</p>
<p><img alt="" src="../images/river_wn.png" /></p>
<pre><code>psource_ncfile:   Nsrc  Isrc  Jsrc  Dsrc qbardir  Lsrc  Tsrc   runoff file name
                                  ROMS_FILES/roms_rivers.nc
                 1
                        56  46  0  -1   30*T   5.0  0.0
</code></pre>
<p>In the <code>cppdefs.h</code> set <code>define</code> to the <code>PSOURCE</code> and <code>PSOURCE_NCFILE</code> variables.</p>
<h2 id="make-in-zoom-in">Make in zoom in</h2>
<p>With the <code>axis([minX maxX minY maxY minZ maxZ])</code> we can manage the zoom into the model.
Introducing setting axis into the loop and adding time to the <code>minX</code> and <code>minY</code> we can
show a zoom to the point.</p>
<h2 id="changing-winds-state">Changing winds state</h2>
<p>See the nc forcing file and the wind variables appears:</p>
<pre><code>nc{'sustr'}
nc{'svstr'}
</code></pre>
<p>and we can modify the value in we are interested, one month of north winds, one week or whatever.
We must know the relation between thc wind velocity and the streess caused by this wind on
the ocean surface. There is equations to solve this issue. Aprox 10m/s will be 0.1N/m2.</p>
<p>Open the file in write mode:</p>
<pre><code>  nc=netcdf('ROMS_FILES/roms_frc.nc', 'w');
  nc{'sustr'}(:,:,:)=0
  nc{'svstr'}(:,:,:)=-.1

  close(nc)
</code></pre>
<h2 id="tides">Tides</h2>
<p>Run:</p>
<pre><code>  &gt;&gt; make_tides
</code></pre>
<p>We need define location and date into the 'romstools_param.m':</p>
<pre><code>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% 5 - Parameters for tidal forcing
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% TPXO file name (TPXO6 or TPXO7)
%
tidename=[DATADIR,'TPXO7/TPXO7.nc'];
%
% Number of tides component to process
%
Ntides=10;
%
% Chose order from the rank in the TPXO file :
% "M2 S2 N2 K2 K1 O1 P1 Q1 Mf Mm"
% " 1  2  3  4  5  6  7  8  9 10"
%
tidalrank=[1 2 3 4 5 6 7 8 9 10];
%
% Compare with tidegauge observations
%
lon0 =  18.37;   % Example:
lat0 = -33.91;   % Cape Town location
Z0   =  1;       % Mean depth of tide gauge
%
</code></pre>
<p>and <code>define TIDES</code> variable in the <code>cppdefs.h</code> file.</p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href=".." title="Index" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Index
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application-06a3e72efd.js"></script>
      <script>app.initialize({url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>